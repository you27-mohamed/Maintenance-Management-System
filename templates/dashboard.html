{% extends "base.html" %}

{% block title %}لوحة التحكم - نظام إدارة الصيانة{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body text-center">
                <h1 class="card-title">
                    <i class="fas fa-tachometer-alt"></i> لوحة التحكم
                </h1>
                <p class="lead">مرحباً {{ session.username }}! اختر الإجراء المطلوب</p>
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    {% if role in ['engineer', 'branch', 'admin'] %}
    <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('create_request') }}" class="card dashboard-card text-decoration-none">
            <div class="text-center">
                <i class="fas fa-plus-circle"></i>
                <h5>إنشاء طلب صيانة</h5>
            </div>
        </a>
    </div>
    {% endif %}
    
    <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('view_requests') }}" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #2196F3, #1976D2);">
            <div class="text-center">
                <i class="fas fa-list"></i>
                <h5>عرض الطلبات</h5>
            </div>
        </a>
    </div>
    
    {% if role in ['engineer', 'admin'] %}
    <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('engineer_dashboard') }}" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #FF9800, #F57C00);">
            <div class="text-center">
                <i class="fas fa-cogs"></i>
                <h5>لوحة المهندس</h5>
            </div>
        </a>
    </div>
    
    <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('report') }}" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #9C27B0, #7B1FA2);">
            <div class="text-center">
                <i class="fas fa-chart-bar"></i>
                <h5>التقارير</h5>
            </div>
        </a>
    </div>
    {% endif %}
    
    {% if role in ['technician', 'admin'] %}
    <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('technician_dashboard') }}" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #607D8B, #455A64);">
            <div class="text-center">
                <i class="fas fa-wrench"></i>
                <h5>لوحة الفني</h5>
            </div>
        </a>
    </div>
    {% endif %}
    
    {% if role == 'admin' %}
    <div class="col-md-6 col-lg-4">
        <a href="#" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #F44336, #D32F2F);">
            <div class="text-center">
                <i class="fas fa-users-cog"></i>
                <h5>إدارة المستخدمين</h5>
            </div>
        </a>
    </div>
    
    <div class="col-md-6 col-lg-4">
        <a href="#" class="card dashboard-card text-decoration-none" style="background: linear-gradient(45deg, #795548, #5D4037);">
            <div class="text-center">
                <i class="fas fa-database"></i>
                <h5>إدارة البيانات</h5>
            </div>
        </a>
    </div>
    {% endif %}
</div>

<!-- Statistics Cards -->
<div class="row mt-4">
    <div class="col-12">
        <h3><i class="fas fa-chart-line"></i> إحصائيات سريعة</h3>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-clipboard-list fa-2x text-primary mb-2"></i>
                <h4 id="total-requests">-</h4>
                <p class="text-muted">إجمالي الطلبات</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-hourglass-half fa-2x text-warning mb-2"></i>
                <h4 id="pending-requests">-</h4>
                <p class="text-muted">طلبات معلقة</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-cog fa-2x text-info mb-2"></i>
                <h4 id="in-progress-requests">-</h4>
                <p class="text-muted">قيد التنفيذ</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                <h4 id="completed-requests">-</h4>
                <p class="text-muted">مكتملة</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Load statistics
fetch('/api/stats')
    .then(response => response.json())
    .then(data => {
        document.getElementById('total-requests').textContent = data.total || 0;
        document.getElementById('pending-requests').textContent = data.pending || 0;
        document.getElementById('in-progress-requests').textContent = data.in_progress || 0;
        document.getElementById('completed-requests').textContent = data.completed || 0;
    })
    .catch(error => {
        console.log('Stats not available');
    });
</script>
{% endblock %}